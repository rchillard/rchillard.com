{"componentChunkName":"component---src-templates-blog-post-js","path":"/2018/12/02-mongoose-vs-candy/","webpackCompilationHash":"a918451c8d62dfe9262d","result":{"data":{"markdownRemark":{"html":"<p><a href=\"https://www.npmjs.com/package/mongoose\">Mongoose</a> is an Object Data Mapper (ODM) which makes it easier for a NodeJS application to interact with MongoDB.  It provides standard functions that allow you to model data through schemas.  </p>\n<h2>Understanding Connections</h2>\n<p>Before we dive in, I like to see the big picture.  How do all these pieces fit together?<br>\nThe puzzle looks like this:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ecf3a82cc47535ebd999c4880cd93e8e/a9751/node-mongoose-mongodb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 208px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 163.94230769230768%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAYAAADZPosTAAAACXBIWXMAAAsSAAALEgHS3X78AAAFcUlEQVRIx51WbWxTZRS+a7cRoyiDbcRhJAEUiYgiKCRqNBpFJfiHxJgYIyrwQ//4kWAQ98P4EYg/jGgwIsg2AUdx34y1Y25t13Wjt5/rd3vXbv1at67d2m7tent3j+e9tHODjaJv8uSc+977Pn3Oec973lKhvyR8XCmHRK+cTxC7GHyyVwH4PjN+pfU1CkdaR4uo2w1CNt3fx6c0A5DWaiBFX59HWivYOc6oh4RKyfr/PL+HrIl1dYpkb+5fmpAoI2TRTimf7FMSNQvB5ywLFhNMSNs7yRoAED1ctqoI3TyoeUvCIsqQjGdNBuDNJgCbBcBqJuAJ5symLDAukoJWqtAghCQskquUjuYtzY2gPl8H2kv1oJPUQ/+FP3hXe1sWhtww2fP3FbJm/YaN5SjnKXQfRTxNphDPIsqoaZUSMnotbooim9ZrOWdbK6eoOcfZWpoQzZyp4TI3LJNmwO0khG2EcMu2bfch4ePoPoN4AbGVuvED5RTm5WAGcwgGHYDTDiQ08DBAFAkgvsMGEAqQkK/lcnj7sEMNkgOxLpl9Wq3S424aJhU9gzF5t5n48V6FEdXr8B0TlXWczBEWbS1fs3gz8gMS8YUT+Rq7F7F6wVzRLQuXG5LdO6kUPbCoWEsqK1cWl5WtuqPwbh60zFJs6LIVGzvoYnn9tRJSY/te2rty52M71pDQZHVXSgztmmJts7qEblKL8z9y+uPf/9PvEHV3LfWioGJNh/mQvst2aFDpOmTssR9m6OCBMz/UHZecaa4mvlHuOGxSOA/qrtk+0nZahaNnsGqLnt/+ytKEQUsUxt0JmPKlYdKXQpsSfOF55MZzxJOAdAjAPuBR5lUuq9R+3csyBj/rs4fZYUuIHbGOsl5LMOs1B1k/zpFnnE8HbBFwaUeayZqDH75f+uW7J5YhHPCAWzcCAcc40HIjXKppECCpbYKG861goxnw2cLZUUcMCX3CSSldUfoOmtcRuxAvI15F7Ea8SAhZt94nKPEMBlinzkuQdem9WYd2iCVKiUK/NQJOeriFEFY9UFUpKhKtQ7cyd54fRNyPWEeF7DGIDCUgEZyFeCANyVBGQCJn4zgfHU7C7BiQkOUF60MjNVfru+zV5l53Ne5mtUXFHOuXGr5WtWu/s6qGjg0qXNWIY1gJ3+Auv0XW/Fbza9Ha1VULj94dnSLR/6rDsDcqjoUS4tRURmw1OsRkwZPbd6x6ZPOWcuEkqfXF07G0OBpMiCP+KVGe9NRnF5cmrPupW7CXu72UtM8pED6xY9c9GzZtFprDhVa1+MdamiK6zn4vFb4lZKc+vbi8yhZ18OYcbMzt4HyY+48KG0wd+aXv9iFfpcMC2Xvfykp7TBMHaGamtlvn1ypMYZWGmflZphvbk//2+AXDnXcDLTPdGmEBgtP/IjQDEEDb74gfJd+4xzjRF6f7C5Odk7orNe4kuMMc7xjNZl1hjiNAfzaQFAg1+U799pFzS5XK4isVc1hBM8n0oG8WDN4UbxpOCzB4Zzh3BADVKwo2hYWjqS9QYRpJz3om8J4azfLWQAZsQZb43CiGjeS9ecKytetJk92cuzorc1cFOXZbEA8JhI0qf4VxODXLjM2BKzzHu9ESnxnnOZJHozc1T1i1YRupRdIM9yGeQ7yRaxB7cw2DomqvWiqsQS7doTTD2fqrfI1Extc1dBFwNn8K8F2+DxYtEfKKW45ek8q/FkPmbIH0nJ6Z5I1DU0Cgc8WyI5MY8sjsQF7hB181Fs7hJyeVK/SeGVdsDu/1CeCZceCHIsB7owBxZLnuStQIf1uyIPq8UGH32acEuW0Do5vUjvhlnWcmZQ+xwqbgzo+rbJMnTrXY7ybfNPT6C3aVfwD+BD4PZnOR+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Application to Interface to Database diagram\"\n        title=\"Application to Interface to Database diagram\"\n        src=\"/static/ecf3a82cc47535ebd999c4880cd93e8e/a9751/node-mongoose-mongodb.png\"\n        srcset=\"/static/ecf3a82cc47535ebd999c4880cd93e8e/395e1/node-mongoose-mongodb.png 196w,\n/static/ecf3a82cc47535ebd999c4880cd93e8e/a9751/node-mongoose-mongodb.png 208w\"\n        sizes=\"(max-width: 208px) 100vw, 208px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Mongoose sits in between NodeJS and MongoDB and acts as the interface in Node for the database.</p>\n<h2>Models and Schemas</h2>\n<p>A data model defines the shape of data or how each piece of data is connected to each other and how they are processed and stored inside a system.  A schema is a way to define a data model.  Let's learn through a few examples:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> dogSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">mongoose<span class=\"token punctuation\">.</span>Schema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">:</span> Number <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Schema is used to define a new model</span>\n<span class=\"token comment\">// The shape of the data is defined here</span>\n\n<span class=\"token keyword\">var</span> Dog <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Dog\"</span><span class=\"token punctuation\">,</span> dogSchema<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Dog is an object that represents a pattern (a compiled model)</span>\n<span class=\"token comment\">// The first parameter \"Dog\" is the singular version of a collection</span>\n<span class=\"token comment\">// mongoose.model takes the second parameter, dogSchema, and generates methods</span>\n\n<span class=\"token keyword\">var</span> fido <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Dog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">:</span> <span class=\"token string\">\"Fido\"</span><span class=\"token punctuation\">,</span> age<span class=\"token punctuation\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Creates an actual dog in memory (JavaScript object)</span>\n\nfido<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> dog</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> error handling happens here <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Stores the actual dog in the database</span></code></pre></div>\n<p>So how does this work inside a NodeJS application?</p>\n<h2>Connecting the Dots</h2>\n<p>I am going to avoid recreating an entire tutorial on Mongoose and MongoDB.  There are already plenty out there, so my notes here will only be to support my own understanding and serve as a reference guide for future me.  If these are too sparse, please refer to another resource.</p>\n<p>First, you have to connect to your MongoDB instance.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Setup Database/Dependency and Connect</span>\n<span class=\"token comment\">// Use mongoose as object-data-mapper</span>\n<span class=\"token keyword\">var</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mongoose\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Connect to the database</span>\nmongoose<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mongodb://localhost:27017/test_db'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> useNewUrlParser<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Next, remember you can separate out your models into separate files for cleanliness.  These are the sample contents of a models/user.js file:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> mongoose <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"mongoose\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">var</span> UserSchema <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">mongoose<span class=\"token punctuation\">.</span>Schema</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    username<span class=\"token punctuation\">:</span> String<span class=\"token punctuation\">,</span>\n    password<span class=\"token punctuation\">:</span> String\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> mongoose<span class=\"token punctuation\">.</span><span class=\"token function\">model</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"User\"</span><span class=\"token punctuation\">,</span> UserSchema<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Since this model has been exported, you can import it elsewhere and then utilize it to create new users or look up users.  Here's some sample code to help illustrate how this works:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// Import mongoose model</span>\n<span class=\"token keyword\">var</span> User <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Create a new user with pattern below:</span>\n<span class=\"token comment\">// User.create({ object }, function(err, user) { error handling here })</span>\n<span class=\"token comment\">// User.create is the combination of both the new and save commands/functions</span>\nUser<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> username<span class=\"token punctuation\">:</span> <span class=\"token string\">\"rchillard\"</span><span class=\"token punctuation\">,</span> password<span class=\"token punctuation\">:</span> <span class=\"token string\">\"12345strongpassword\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> user</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Query for an object using Mongoose method</span>\n<span class=\"token comment\">// User.find is the essential READ command and it's structured as:</span>\n<span class=\"token comment\">// User.find({ matching criteria }, function(err) { error handling })</span>\nUser<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> username<span class=\"token punctuation\">:</span> <span class=\"token string\">\"rchillard\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> foundUser</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>foundUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Please don't ever actually create users and passwords as above.  This was just sample code.  I recommend you checkout <a href=\"http://www.passportjs.org/\">Passport</a>, a Node.js package that specializes in authentication.</p>\n<h2>Conclusion</h2>\n<p>Mongoose serves as a layer or interface between your application and your database, and that saves you from having to write duplicative code or worry about lower level concerns.  This post helped to illustrate how models and schemas work to realize that dream of ease.\n\n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 784px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 66.68508287292818%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECBP/EABYBAQEBAAAAAAAAAAAAAAAAAAABA//aAAwDAQACEAMQAAABh28ZlNgf/8QAGRAAAwADAAAAAAAAAAAAAAAAAAECETFB/9oACAEBAAEFApHIkcl5NH//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwFX/8QAFhAAAwAAAAAAAAAAAAAAAAAAACBx/9oACAEBAAY/Air/AP/EABgQAQEBAQEAAAAAAAAAAAAAAAEAESEx/9oACAEBAAE/IRrOGTA7PIhO9s8X/9oADAMBAAIAAwAAABAz/wD/xAAXEQEAAwAAAAAAAAAAAAAAAAAAARFB/9oACAEDAQE/ENXL/8QAFhEAAwAAAAAAAAAAAAAAAAAAEBFB/9oACAECAQE/EHQ//8QAGhABAQEBAQEBAAAAAAAAAAAAAREAMSGBkf/aAAgBAQABPxBRUShzMjWkE/fcIij9yqnQ8da0V0wUiy7/2Q=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Mongoose animal standing in grass\"\n        title=\"Mongoose animal standing in grass\"\n        src=\"/static/05f2012b3c35de08ad1dd7d760b6e08b/4075b/mongoose-in-grass.jpg\"\n        srcset=\"/static/05f2012b3c35de08ad1dd7d760b6e08b/80858/mongoose-in-grass.jpg 196w,\n/static/05f2012b3c35de08ad1dd7d760b6e08b/f9670/mongoose-in-grass.jpg 392w,\n/static/05f2012b3c35de08ad1dd7d760b6e08b/4075b/mongoose-in-grass.jpg 784w,\n/static/05f2012b3c35de08ad1dd7d760b6e08b/690ca/mongoose-in-grass.jpg 1176w,\n/static/05f2012b3c35de08ad1dd7d760b6e08b/6954b/mongoose-in-grass.jpg 1568w,\n/static/05f2012b3c35de08ad1dd7d760b6e08b/3ffae/mongoose-in-grass.jpg 3620w\"\n        sizes=\"(max-width: 784px) 100vw, 784px\"\n      />\n    </span>\n  </span>\n  \nHans Veth via <a href=\"https://unsplash.com/photos/rpusvLxS0oA\">Unsplash</a></p>\n<p>Let's get fancy and preview something more advanced:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">Object<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>matching criteria<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">populate</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">exec</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> user</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span> <span class=\"token keyword\">do</span> something <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// Return object from the database - hydrate data from the IDs - execute search with callback</span></code></pre></div>\n<p>Checkout what this does by reading the <a href=\"https://mongoosejs.com/docs/populate.html\">Mongoose docs</a>.  They're a pretty <em>quick</em> read.</p>","timeToRead":3,"frontmatter":{"title":"Mongoose vs. Candy","date":"December 02, 2018","tags":["databases","mongodb"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/2018/12/02-mongoose-vs-candy/","prev":"/2018/12/01-mongo-like-candy/","next":"/2018/12/03-the-brave-new-javascript/"}}}